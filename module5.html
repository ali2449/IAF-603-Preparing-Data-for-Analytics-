<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Module 5: SQL Logic - IAF 603</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&family=Source+Code+Pro:wght@400;500;700&display=swap" rel="stylesheet">
    <!-- Highlight.js for code highlighting -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/default.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <!-- MathJax CDN -->
    <script src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <!-- Custom MathJax Configuration -->
    <script src="./js/mathjax.js"></script>
    <!-- Custom Styles -->
    <link rel="stylesheet" href="./css/styles.css">
</head>
<body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg navbar-light bg-light shadow-sm sticky-top">
        <div class="container-fluid">
            <a class="navbar-brand" href="./index.html">IAF 603: Preparing Data for Analytics</a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav" aria-controls="navbarNav" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">Home</a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            Modules
                        </a>
                        <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                            <li><a class="dropdown-item" href="./module1.html">Module 1</a></li>
                            <li><a class="dropdown-item" href="./module2.html">Module 2</a></li>
                            <li><a class="dropdown-item" href="./module3.html">Module 3</a></li>
                            <li><a class="dropdown-item" href="./module4.html">Module 4</a></li>
                            <li><a class="dropdown-item" href="./module5.html">Module 5</a></li>
                            <li><a class="dropdown-item" href="./module6.html">Module 6</a></li>
                            <li><a class="dropdown-item" href="./module7.html">Module 7</a></li>
                            <li><a class="dropdown-item" href="./module8.html">Module 8</a></li>
                            <li><a class="dropdown-item" href="./module9.html">Module 9</a></li>
                            <li><a class="dropdown-item" href="./module10.html">Module 10</a></li>
                            <li><a class="dropdown-item" href="./module11.html">Module 11</a></li>
                            <li><a class="dropdown-item" href="./module12.html">Module 12</a></li>
                            <li><a class="dropdown-item" href="./module13.html">Module 13</a></li>
                            <li><a class="dropdown-item" href="./module14.html">Module 14</a></li>
                        </ul>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html#contact">Contact</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- Main Content -->
    <div class="container my-5">
        <!-- Module Title -->
        <section class="text-center py-5 bg-white rounded shadow">
            <h1 class="display-4 fw-bold text-dark">Module 5: SQL Logic</h1>
        </section>

        <!-- Module Content -->
        <section class="my-5">
            <div class="bg-white p-4 rounded shadow">
                <!-- Learning Objectives -->
                <h2 class="h3 fw-bold border-bottom pb-2 mb-4">Learning Objectives</h2>
                <p>Upon completion of this module, participants will be able to:</p>
                <ul>
                    <li>Implement Boolean logic using <code>AND</code>, <code>OR</code>, and <code>NOT</code> operators to create complex SQL conditions.</li>
                    <li>Handle NULL values effectively using <code>IS NULL</code>, <code>COALESCE</code>, and <code>NULLIF</code> for robust data filtering and transformation.</li>
                    <li>Use <code>CASE</code> statements to implement conditional logic for categorizing and transforming data.</li>
                    <li>Combine logical operators, NULL handling, and <code>CASE</code> statements in SQL queries to address real-world data preparation challenges.</li>
                    <li>Apply these techniques in cloud-based environments like Microsoft Fabric Lakehouse.</li>
                </ul>

                <!-- Introduction to SQL Logic -->
                <h2 class="h3 fw-bold border-bottom pb-2 mb-4">Introduction to SQL Logic</h2>
                <p>SQL logic enables advanced data filtering and transformation by applying conditional logic to queries. This module dives into Boolean logic (<code>AND</code>, <code>OR</code>, <code>NOT</code>), NULL handling (<code>IS NULL</code>, <code>COALESCE</code>, <code>NULLIF</code>), and <code>CASE</code> statements for conditional transformations. These tools are essential for preparing data for analytics, allowing you to handle complex filtering scenarios, manage missing data, and create derived categories. For example, in a Greensboro hospital, SQL logic can categorize patients by risk level based on age and diagnosis, or in a retail setting, identify high-value customers based on purchase patterns. Mastering these techniques ensures you can tailor data to specific analytical needs.</p>
                <p>Boolean logic and NULL handling are critical because real-world datasets often contain incomplete or ambiguous data. <code>CASE</code> statements add flexibility, enabling dynamic transformations without external processing. These skills are foundational for later modules on joins, subqueries, and advanced analytics.</p>

                <!-- Boolean Logic in SQL -->
                <h3 class="h4 fw-bold mb-3">Boolean Logic in SQL</h3>
                <p>Boolean logic uses <code>AND</code>, <code>OR</code>, and <code>NOT</code> to combine conditions in the <code>WHERE</code> clause, allowing precise filtering.</p>
                <ul>
                    <li><strong>AND:</strong> Both conditions must be true (e.g., age > 50 AND diagnosis = 'Pneumonia').</li>
                    <li><strong>OR:</strong> At least one condition must be true (e.g., gender = 'Female' OR age < 30).</li>
                    <li><strong>NOT:</strong> Inverts a condition (e.g., NOT diagnosis = 'Flu').</li>
                    <li><strong>Parentheses:</strong> Control precedence for complex conditions (e.g., (age > 50 OR gender = 'Female') AND diagnosis = 'Pneumonia').</li>
                </ul>
                <p><strong>Sample Data (PATIENTS Table):</strong></p>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>subject_id</th>
                            <th>name</th>
                            <th>age</th>
                            <th>gender</th>
                            <th>blood_type</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1001</td>
                            <td>Alice Smith</td>
                            <td>45</td>
                            <td>Female</td>
                            <td>A+</td>
                        </tr>
                        <tr>
                            <td>1002</td>
                            <td>Bob Johnson</td>
                            <td>32</td>
                            <td>Male</td>
                            <td>O-</td>
                        </tr>
                        <tr>
                            <td>1003</td>
                            <td>Carol White</td>
                            <td>58</td>
                            <td>Female</td>
                            <td>AB+</td>
                        </tr>
                        <tr>
                            <td>1004</td>
                            <td>David Brown</td>
                            <td>67</td>
                            <td>Male</td>
                            <td>B+</td>
                        </tr>
                    </tbody>
                </table>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Patients who are female and over 50
SELECT name, age, gender
FROM PATIENTS
WHERE gender = 'Female' AND age > 50;

-- Patients who are either under 40 or have blood type O-
SELECT name, age, blood_type
FROM PATIENTS
WHERE age < 40 OR blood_type = 'O-';

-- Patients not male with age between 30 and 60
SELECT name, age, gender
FROM PATIENTS
WHERE NOT gender = 'Male' AND age BETWEEN 30 AND 60;</code></pre>
                </div>
                <p><strong>Explanation:</strong> The first query targets older female patients, the second includes younger patients or those with O- blood type, and the third excludes males while focusing on a specific age range. Parentheses can enhance clarity in complex conditions.</p>
                <p><strong>Expanded Example (Sales Table):</strong></p>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>sale_id</th>
                            <th>product</th>
                            <th>quantity</th>
                            <th>price</th>
                            <th>category</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>Laptop</td>
                            <td>2</td>
                            <td>800.00</td>
                            <td>Electronics</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Mouse</td>
                            <td>5</td>
                            <td>20.00</td>
                            <td>Accessories</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Keyboard</td>
                            <td>3</td>
                            <td>50.00</td>
                            <td>Accessories</td>
                        </tr>
                        <tr>
                            <td>4</td>
                            <td>Monitor</td>
                            <td>1</td>
                            <td>300.00</td>
                            <td>Electronics</td>
                        </tr>
                    </tbody>
                </table>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- High-value electronics sales
SELECT product, quantity, price
FROM Sales
WHERE category = 'Electronics' AND (quantity * price) > 500;

-- Non-accessory sales with price < 100 or quantity > 3
SELECT product, category, (quantity * price) AS TotalCost
FROM Sales
WHERE NOT category = 'Accessories' OR quantity > 3;</code></pre>
                </div>
                <p><strong>Explanation:</strong> The first query identifies high-value electronics sales, using a derived column in the condition. The second excludes accessories or includes high-quantity sales, useful for inventory analysis.</p>

                <!-- NULL Handling in SQL -->
                <h3 class="h4 fw-bold mb-3">NULL Handling in SQL</h3>
                <p>NULL represents missing or unknown data in SQL. It requires special handling because it doesn't behave like other values (e.g., <code>NULL = NULL</code> is false). Key functions include <code>IS NULL</code>, <code>COALESCE</code>, and <code>NULLIF</code>.</p>
                <ul>
                    <li><strong>IS NULL:</strong> Tests if a column is NULL (e.g., <code>WHERE blood_type IS NULL</code>).</li>
                    <li><strong>COALESCE:</strong> Returns the first non-NULL value from a list of arguments (e.g., <code>COALESCE(blood_type, 'Unknown')</code>).</li>
                    <li><strong>NULLIF:</strong> Converts a specified value to NULL (e.g., <code>NULLIF(diagnosis, 'Unknown')</code>).</li>
                </ul>
                <p><strong>Sample Data (ADMISSIONS Table):</strong></p>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>hadm_id</th>
                            <th>subject_id</th>
                            <th>admit_time</th>
                            <th>discharge_time</th>
                            <th>diagnosis</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>101</td>
                            <td>1001</td>
                            <td>2025-01-10 08:00:00</td>
                            <td>2025-01-15 12:00:00</td>
                            <td>Pneumonia</td>
                        </tr>
                        <tr>
                            <td>102</td>
                            <td>1002</td>
                            <td>2025-02-01 14:00:00</td>
                            <td>NULL</td>
                            <td>Fracture</td>
                        </tr>
                        <tr>
                            <td>103</td>
                            <td>1001</td>
                            <td>2025-03-05 10:00:00</td>
                            <td>2025-03-12 15:00:00</td>
                            <td>Unknown</td>
                        </tr>
                        <tr>
                            <td>104</td>
                            <td>1003</td>
                            <td>2025-04-10 07:00:00</td>
                            <td>NULL</td>
                            <td>Flu</td>
                        </tr>
                    </tbody>
                </table>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Find admissions with no discharge time
SELECT hadm_id, subject_id
FROM ADMISSIONS
WHERE discharge_time IS NULL;

-- Replace NULL discharge time with 'Ongoing'
SELECT hadm_id, COALESCE(discharge_time::TEXT, 'Ongoing') AS DischargeStatus
FROM ADMISSIONS;

-- Convert 'Unknown' diagnosis to NULL
SELECT hadm_id, NULLIF(diagnosis, 'Unknown') AS CleanDiagnosis
FROM ADMISSIONS;</code></pre>
                </div>
                <p><strong>Explanation:</strong> <code>IS NULL</code> identifies ongoing hospital stays. <code>COALESCE</code> provides a default for NULLs, improving readability. <code>NULLIF</code> cleans ambiguous data by converting 'Unknown' to NULL.</p>
                <p><strong>Expanded Example (Employees Table):</strong></p>
                <table class="table table-bordered">
                    <thead>
                        <tr>
                            <th>emp_id</th>
                            <th>name</th>
                            <th>salary</th>
                            <th>department</th>
                            <th>phone</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr>
                            <td>1</td>
                            <td>John Doe</td>
                            <td>60000</td>
                            <td>IT</td>
                            <td>555-1234</td>
                        </tr>
                        <tr>
                            <td>2</td>
                            <td>Jane Smith</td>
                            <td>75000</td>
                            <td>HR</td>
                            <td>NULL</td>
                        </tr>
                        <tr>
                            <td>3</td>
                            <td>Mike Johnson</td>
                            <td>55000</td>
                            <td>IT</td>
                            <td>000-0000</td>
                        </tr>
                    </tbody>
                </table>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Employees with missing phone numbers
SELECT name, department
FROM Employees
WHERE phone IS NULL;

-- Provide default phone number
SELECT name, COALESCE(phone, 'Not Provided') AS ContactNumber
FROM Employees;

-- Convert invalid phone '000-0000' to NULL
SELECT name, NULLIF(phone, '000-0000') AS CleanPhone
FROM Employees;</code></pre>
                </div>
                <p><strong>Explanation:</strong> These queries handle missing or invalid contact data, ensuring cleaner datasets for HR analysis.</p>

                <!-- CASE Statements: Conditional Logic -->
                <h3 class="h4 fw-bold mb-3">CASE Statements: Conditional Logic</h3>
                <p><code>CASE</code> statements introduce if-then-else logic, allowing data transformation and categorization based on conditions.</p>
                <ul>
                    <li><strong>Simple CASE:</strong> Matches a column against values (e.g., categorize diagnosis).</li>
                    <li><strong>Searched CASE:</strong> Uses conditions for flexibility (e.g., categorize by age range).</li>
                    <li><strong>Use Cases:</strong> Create derived columns, flag records, or simplify complex logic.</li>
                </ul>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Categorize patients by age group
SELECT
    name,
    age,
    CASE
        WHEN age < 30 THEN 'Young Adult'
        WHEN age BETWEEN 30 AND 50 THEN 'Adult'
        WHEN age > 50 THEN 'Senior'
        ELSE 'Unknown'
    END AS AgeGroup
FROM PATIENTS;

-- Flag high-risk diagnoses
SELECT
    hadm_id,
    diagnosis,
    CASE diagnosis
        WHEN 'Pneumonia' THEN 'High Risk'
        WHEN 'Flu' THEN 'Moderate Risk'
        ELSE 'Low Risk'
    END AS RiskLevel
FROM ADMISSIONS;</code></pre>
                </div>
                <p><strong>Explanation:</strong> The first query categorizes patients into age groups for demographic analysis. The second flags diagnoses by risk, aiding clinical prioritization.</p>
                <p><strong>Expanded Example (Sales Analysis):</strong></p>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Categorize sales by value
SELECT
    product,
    (quantity * price) AS TotalCost,
    CASE
        WHEN (quantity * price) > 1000 THEN 'High Value'
        WHEN (quantity * price) BETWEEN 100 AND 1000 THEN 'Medium Value'
        ELSE 'Low Value'
    END AS SaleCategory
FROM Sales;</code></pre>
                </div>
                <p><strong>Explanation:</strong> This categorizes sales for marketing strategies, identifying high-value transactions.</p>

                <!-- Combining SQL Logic -->
                <h3 class="h4 fw-bold mb-3">Combining Boolean Logic, NULL Handling, and CASE</h3>
                <p>Combining these tools creates powerful queries for complex data preparation.</p>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Complex query: Flag patients with missing discharge or high-risk conditions
SELECT
    subject_id,
    diagnosis,
    COALESCE(discharge_time::TEXT, 'Ongoing') AS DischargeStatus,
    CASE
        WHEN diagnosis = 'Pneumonia' AND age > 50 THEN 'Critical'
        WHEN discharge_time IS NULL THEN 'Under Review'
        ELSE 'Standard'
    END AS PatientStatus
FROM ADMISSIONS
JOIN PATIENTS ON ADMISSIONS.subject_id = PATIENTS.subject_id
WHERE age > 40 OR diagnosis IN ('Pneumonia', 'Flu');</code></pre>
                </div>
                <p><strong>Explanation:</strong> This joins tables, handles NULLs with <code>COALESCE</code>, filters with Boolean logic, and categorizes with <code>CASE</code> for patient monitoring.</p>
                <p><strong>Expanded Example (Employee Bonuses):</strong></p>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Flag employees for bonus eligibility
SELECT
    name,
    department,
    salary,
    COALESCE(phone, 'Not Provided') AS Contact,
    CASE
        WHEN salary > 70000 AND department = 'IT' THEN 'Eligible'
        WHEN phone IS NULL THEN 'Contact Missing'
        ELSE 'Not Eligible'
    END AS BonusStatus
FROM Employees
WHERE department IN ('IT', 'HR') AND salary > 50000;</code></pre>
                </div>
                <p><strong>Explanation:</strong> Identifies bonus-eligible employees based on salary and department, handling missing contact info.</p>

                <!-- Running Queries in Microsoft Fabric -->
                <h3 class="h4 fw-bold mb-3">Running Queries in Microsoft Fabric Lakehouse</h3>
                <p>Microsoft Fabric supports complex SQL logic in its Lakehouse environment, enabling scalable processing of large datasets.</p>
                <div class="code-block">
                    <button class="btn btn-sm btn-secondary copy-btn" onclick="copyCode(this)">Copy</button>
                    <pre><code class="language-sql">-- Categorize survey responses in Fabric
SELECT
    respondent_id,
    satisfaction_score,
    CASE
        WHEN satisfaction_score >= 4 THEN 'Positive'
        WHEN satisfaction_score IS NULL THEN 'Missing'
        ELSE 'Negative'
    END AS FeedbackType
FROM survey_lakehouse.Responses
WHERE response_date >= '2025-01-01' AND (city = 'Greensboro' OR satisfaction_score IS NULL);</code></pre>
                </div>
                <p><strong>Explanation:</strong> Categorizes recent survey feedback, handling NULL scores and focusing on Greensboro responses.</p>

                <!-- Assessments -->
                <h2 class="h3 fw-bold border-bottom pb-2 mb-4">Assessments</h2>
                <ol>
                    <li><strong>Conceptual Question:</strong> Explain why <code>NULL = NULL</code> is false in SQL, and how <code>IS NULL</code> and <code>COALESCE</code> address this.</li>
                    <li><strong>SQL Coding Task:</strong> Using the ADMISSIONS table, write a query to categorize admissions as 'Short Stay' (< 3 days), 'Medium Stay' (3-7 days), or 'Long Stay' (> 7 days), excluding NULL discharge times.</li>
                    <li><strong>Application Scenario:</strong> For a Greensboro retail store, query the Sales table to flag high-value sales (> $500) in Electronics, handling NULL categories with 'Unknown'.</li>
                    <li><strong>Expanded Task:</strong> For a university database, query a Students table to categorize students by GPA (High: >3.5, Medium: 2.5-3.5, Low: <2.5), handling NULL GPAs, and filter for students in specific majors.</li>
                </ol>
            </div>
        </section>
    </div>

    <!-- Footer -->
    <footer class="bg-light py-3 text-center">
        <p class="text-muted mb-0">&copy; 2025 Ali Noori, UNCG. All rights reserved.</p>
    </footer>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <!-- Highlight.js Initialization -->
    <script>hljs.highlightAll();</script>
    <!-- Custom Copy Functionality -->
    <script>
        function copyCode(button) {
            const code = button.nextElementSibling.querySelector('code');
            navigator.clipboard.writeText(code.innerText).then(() => {
                button.textContent = 'Copied!';
                setTimeout(() => { button.textContent = 'Copy'; }, 2000);
            });
        }
    </script>
</body>
</html>